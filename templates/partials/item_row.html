{% load static %}
{% load sprite_tags %}

<div class="space-y-3 sm:space-y-0" data-item="{{ item.id }}" >
    <!-- Main content row -->
    <div class="flex items-center justify-between">
        <div class="flex-1 min-w-0">
            <div class="flex items-center space-x-3">
                <div class="flex-shrink-0">
                    <div class="h-6 w-6 text-gray-400" title="{{ item.get_status_display }}">
                        {% sprite item.flow.sprite|default:"archive" 24 %}
                    </div>
                </div>
                <div class="flex-1 min-w-0">
                    <div class="relative">
                        <h3 class="text-sm font-medium text-gray-900 truncate">
                            {{ item.title }}
                            {% if item.is_waiting_for %}
                                <span class="inline-flex items-center px-2.5 py-0.5 font-extrabold">
                                    {{ item.waiting_for_person }}
                                </span>
                            {% endif %}
                        </h3>
                        {% if item.description %}
                        <p class="text-sm text-gray-500 truncate">
                            {{ item.description }}
                        </p>
                        {% endif %}
                        <button class="expand-target" data-detail-url="{% url 'item_detail' item_id=item.id %}"></button>
                    </div>
                    <div class="mt-1 flex items-center flex-wrap gap-x-4 gap-y-1 text-xs">
                        <span class="text-gray-500">Created {{ item.created_at|date:"M j, Y" }}</span>

                        {% if item.priority != 2 %}
                        <span class="inline-flex items-center {{ item.priority_color }}">
                            {% sprite item.priority_icon 12 class="mr-1 {{ item.priority_color }}" %}
                            <span>{{ item.get_priority_display }}</span>
                        </span>
                        {% endif %}

                        {% if item.area %}
                        <span class="inline-flex items-center text-green-600 {{item_secondary_classes}}" data-area="{{ item.area.pk }}">
                            {% sprite "lucide-target" 12 class="mr-1" %}
                            {{ item.area.name }}
                        </span>
                        {% endif %}

                        {% if item.contexts.exists %}
                        <span class="inline-flex items-center text-purple-600">
                            {% sprite "lucide-hash" 12 class="mr-1" %}
                            {% for context in item.contexts.all %}
                                <span data-context="{{context.name}}" class="{{item_secondary_classes}}">{{ context.name }}</span>
                                {% if not forloop.last %}, {% endif %}
                            {% endfor %}
                        </span>
                        {% endif %}

                        {% if item.parent %}
                            {% if item.parent.is_reference %}
                                <span class="inline-flex items-center text-blue-600 {{item_secondary_classes}}" data-project="{{ item.parent.pk }}">
                                    {% sprite "lucide-archive" 12 class="mr-1" %}
                                    {{ item.parent.title }}
                                </span>
                            {% else %}
                                <span class="inline-flex items-center text-green-600 {{item_secondary_classes}}" data-project="{{ item.parent.pk }}">
                                    {% sprite "lucide-folder" 12 class="mr-1" %}
                                    {{ item.parent.title }}
                                </span>
                            {% endif %}
                        {% endif %}
                        {% if item.is_project %}
                                <span class="inline-flex items-center text-green-600 {{item_secondary_classes}}" data-project="{{ item.pk }}">
                                    {% sprite "lucide-folder" 12 class="mr-1" %}
                                    {{ item.title }}
                                </span>
                        {% endif %}

                        {% if item.energy %}
                            <span data-energy="{{ item.energy }}" class="{{item_secondary_classes}}">{{item.get_energy_display}}</span>
                        {% endif %}

                        {% for tag in item.tags.all %}
                            <span data-tag="{{tag.name}}" class="{{item_secondary_classes}}">{{ tag.name }}</span>
                            {% if not forloop.last %}, {% endif %}
                        {% endfor %}

                    </div>
                </div>
            </div>
        </div>
        <div class="flex-shrink-0 flex space-x-2">
            <!-- Edit Button -->
            <a href="{% url 'item_update' item_id=item.id %}" class="inline-flex items-center px-1.5 py-1.5 border border-gray-300 shadow-sm text-xs font-medium rounded text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" title="Edit item">
                {% sprite "lucide-pencil" 24 %}
            </a>
            <!-- Process Actions - Desktop only -->
            <div class="hidden sm:block">
                {% include "partials/item_dropdown.html" with item=item %}
            </div>
        </div>
    </div>

    <!-- Mobile actions row -->
    <div class="sm:hidden">
        {% include "partials/item_dropdown.html" with item=item %}
    </div>
</div>